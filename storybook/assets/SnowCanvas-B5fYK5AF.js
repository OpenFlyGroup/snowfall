import{j as C}from"./jsx-runtime-u17CrQMm.js";import{r as m}from"./iframe-DQzrXPAg.js";import{u as E}from"./snow-store-ByKeuMue.js";class k{constructor(t,e){this.snowflakes=[],this.lastTime=0,this.isRunning=!1,this.config={},this.width=0,this.height=0,this.handleResize=()=>{this.resizeCanvas()},this.animate=(i=0)=>{if(!this.isRunning)return;const s=i-this.lastTime;this.lastTime=i,this.updateSnowflakes(s),this.clearCanvas(),this.drawSnowflakes(),this.snowflakes.length<this.config.intensity&&Math.random()>.7&&this.addSnowflake({}),this.animationId=requestAnimationFrame(this.animate)},this.canvas=t,this.config=e;const n=t.getContext("2d");if(!n)throw new Error("Canvas context not found");this.ctx=n}init(){this.resizeCanvas(),window.addEventListener("resize",this.handleResize),this.createInitialSnowflakes()}start(){this.isRunning||(this.isRunning=!0,this.lastTime=performance.now(),this.animate())}stop(){this.isRunning=!1,this.animationId&&cancelAnimationFrame(this.animationId)}destroy(){this.stop(),window.removeEventListener("resize",this.handleResize),this.snowflakes=[]}updateConfig(t){this.config={...this.config,...t}}getSnowflakes(){return this.snowflakes}recycleSnowflake(t){const e=this.snowflakes.find(n=>n.id===t);e&&(e.y=-10,e.x=Math.random()*this.width)}addSnowflake(t){const e=Math.random().toString(36).substr(2,9);this.snowflakes.push({id:e,x:t.x??Math.random()*this.width,y:t.y??-10,size:t.size??this.randomSize(),speed:t.speed??Math.random()*1.5+.5,opacity:t.opacity??Math.random()*.7+.3,wind:t.wind??(Math.random()-.5)*this.config.windStrength,rotation:t.rotation??0,rotationSpeed:t.rotationSpeed??(Math.random()-.5)*.02,shape:t.shape??this.randomShape()})}resizeCanvas(){const t=window.devicePixelRatio||1,e=this.canvas.getBoundingClientRect();this.width=e.width,this.height=e.height,this.canvas.width=e.width*t,this.canvas.height=e.height*t,this.ctx.setTransform(t,0,0,t,0,0),this.canvas.style.width=`${e.width}px`,this.canvas.style.height=`${e.height}px`}createInitialSnowflakes(){const t=Math.floor(this.config.intensity*.3);for(let e=0;e<t;e++)this.addSnowflake({})}updateSnowflakes(t){const e=t/16;this.snowflakes.forEach(n=>{n.y+=n.speed*e,n.x+=n.wind*e,n.rotation+=n.rotationSpeed*e,n.y>this.height&&(n.y=-10,n.x=Math.random()*this.width),n.x>this.width&&(n.x=0),n.x<0&&(n.x=this.width)})}drawSnowflakes(){this.snowflakes.forEach(t=>{switch(this.ctx.save(),this.ctx.translate(t.x,t.y),this.ctx.rotate(t.rotation),this.ctx.fillStyle=this.getSnowflakeColor(t.opacity),t.shape){case"star":this.drawStar(t.size);break;case"cross":this.drawCross(t.size);break;default:this.drawCircle(t.size)}this.ctx.restore()})}drawCircle(t){this.ctx.beginPath(),this.ctx.arc(0,0,t,0,Math.PI*2),this.ctx.fill()}drawStar(t){const n=t,i=t*.5;this.ctx.beginPath();for(let s=0;s<10;s++){const a=s%2===0?n:i,h=Math.PI*s/5,d=Math.cos(h)*a,o=Math.sin(h)*a;s===0?this.ctx.moveTo(d,o):this.ctx.lineTo(d,o)}this.ctx.closePath(),this.ctx.fill()}drawCross(t){this.ctx.fillRect(-t,-t/3,t*2,t*.66),this.ctx.fillRect(-t/3,-t,t*.66,t*2)}getSnowflakeColor(t){return this.config.colors[Math.floor(Math.random()*this.config.colors.length)].replace("opacity",t.toString())}randomSize(){return Math.random()*(this.config.snowflakeSize.max-this.config.snowflakeSize.min)+this.config.snowflakeSize.min}randomShape(){return this.config.shapes[Math.floor(Math.random()*this.config.shapes.length)]}clearCanvas(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}}class I{constructor(){this.elements=new Map,this.elementRects=new Map}registerElement(t,e,n={}){this.elements.set(t,{element:e,id:t,priority:n.priority||0,accumulationArea:n.accumulationArea||"top"}),this.updateRect(t)}unregisterElement(t){this.elements.delete(t),this.elementRects.delete(t)}updateRects(){this.elements.forEach((t,e)=>this.updateRect(e))}getElementRect(t){return this.elementRects.get(t)??null}updateRect(t){const e=this.elements.get(t);e&&this.elementRects.set(t,e.element.getBoundingClientRect())}checkCollision(t,e){let n=null,i=-1;return this.elementRects.forEach((s,a)=>{const h=this.elements.get(a);if(t>=s.left&&t<=s.right&&e>=s.top&&e<=s.bottom)if(h.accumulationArea==="top"){const d=s.height*.3;e<=s.top+d&&h.priority>i&&(i=h.priority,n=a)}else h.priority>i&&(i=h.priority,n=a)}),n}getCollisionPoint(t,e,n){const i=this.elementRects.get(t);if(!i)return{x:e,y:n};if(this.elements.get(t).accumulationArea==="top"){const a=i.top+i.height*.3;return{x:Math.max(i.left,Math.min(e,i.right)),y:Math.max(i.top,Math.min(n,a))}}return{x:Math.max(i.left,Math.min(e,i.right)),y:Math.max(i.top,Math.min(n,i.bottom))}}}function z({className:S="",style:t,accumulationElements:e=[],onSnowflakeStuck:n}){const i=m.useRef(null),s=m.useRef(null),a=m.useRef(new I),h=m.useRef(void 0),{isEnabled:d,config:o,addStuckSnowflake:x,removeStuckSnowflake:y}=E();m.useEffect(()=>{const c=i.current;if(!c||!d)return;const r=new k(c,o);return s.current=r,r.init(),r.start(),()=>{r.destroy(),s.current=null}},[d]),m.useEffect(()=>{s.current&&s.current.updateConfig(o)},[o]),m.useEffect(()=>{if(!o.accumulation)return;const c=[];e.forEach(f=>{document.querySelectorAll(f).forEach((l,u)=>{const g=l.dataset.snowId||l.id||`${f.replace(/[^a-z0-9_-]/gi,"")}-${u}`;c.push(g),a.current.registerElement(g,l,{priority:0,accumulationArea:"top"})})});const r=()=>{a.current.updateRects()};return window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r),c.forEach(f=>a.current.unregisterElement(f))}},[e,o.accumulation]);const v=m.useCallback(()=>{if(!s.current||!o.accumulation)return;const c=s.current,r=c.getSnowflakes(),f=Date.now();r.forEach(w=>{const l=a.current.checkCollision(w.x,w.y);if(l){const u=a.current.getCollisionPoint(l,w.x,w.y),p=a.current.getElementRect(l),g=p?u.x-p.left:u.x,M=p?u.y-p.top:u.y,R={...w,stuck:!0,stuckTime:f,fadeStart:f+o.fadeDelay,elementId:l,x:g,y:M};x(l,R),n?.(l,R),c.recycleSnowflake(w.id)}})},[o.accumulation,o.fadeDelay,x,n]);return m.useEffect(()=>{if(!o.accumulation)return;const c=()=>{const r=Date.now(),{stuckSnowflakes:f}=E.getState();f.forEach((w,l)=>{w.forEach(u=>{u.fadeStart&&r>u.fadeStart&&(r-u.fadeStart)/o.fadeDuration>=1&&y(l,u.id)})})};return h.current=window.setInterval(c,100),()=>{h.current&&clearInterval(h.current)}},[o.accumulation,o.fadeDuration,y]),m.useEffect(()=>{if(!d||!o.accumulation)return;const c=()=>{v(),requestAnimationFrame(c)},r=requestAnimationFrame(c);return()=>cancelAnimationFrame(r)},[d,o.accumulation,v]),d?C.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",pointerEvents:"none",zIndex:50},children:C.jsx("canvas",{ref:i,className:`fixed inset-0 pointer-events-none z-50 ${S}`,style:{...t,display:"block",width:"100%",height:"100%"}})}):null}z.__docgenInfo={description:`Component for rendering snowfall effect on a canvas with snowflake accumulation on specified elements.

@prop {string} [className] - CSS classes for the canvas element.
@prop {object} [style] - CSS styles for the canvas element.
@prop {string[]} [accumulationElements] - Selectors for elements where snowflakes should accumulate.
@prop {function} [onSnowflakeStuck] - Function called when a snowflake collides with an element.`,methods:[],displayName:"SnowCanvas",props:{className:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:'""',computed:!1}},style:{required:!1,tsType:{name:"ReactCSSProperties",raw:"React.CSSProperties"},description:""},accumulationElements:{required:!1,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:"",defaultValue:{value:"[]",computed:!1}},onSnowflakeStuck:{required:!1,tsType:{name:"signature",type:"function",raw:"(elementId: string, flake: StuckSnowflake) => void",signature:{arguments:[{type:{name:"string"},name:"elementId"},{type:{name:"StuckSnowflake"},name:"flake"}],return:{name:"void"}}},description:""}}};export{z as S};
