import{j as v}from"./jsx-runtime-u17CrQMm.js";import{r as u}from"./iframe-PL5-iZbX.js";import{u as y}from"./snow-store-6Yei7rue.js";class R{constructor(t,e){this.snowflakes=[],this.lastTime=0,this.isRunning=!1,this.config={},this.animate=(i=0)=>{if(!this.isRunning)return;const s=i-this.lastTime;this.lastTime=i,this.updateSnowflakes(s),this.clearCanvas(),this.drawSnowflakes(),this.snowflakes.length<this.config.intensity&&Math.random()>.7&&this.addSnowflake({}),this.animationId=requestAnimationFrame(this.animate)},this.canvas=t,this.config=e;const n=t.getContext("2d");if(!n)throw new Error("Canvas context not found");this.ctx=n}init(){this.resizeCanvas(),window.addEventListener("resize",this.resizeCanvas.bind(this)),this.createInitialSnowflakes()}start(){this.isRunning||(this.isRunning=!0,this.lastTime=performance.now(),this.animate())}stop(){this.isRunning=!1,this.animationId&&cancelAnimationFrame(this.animationId)}destroy(){this.stop(),window.removeEventListener("resize",this.resizeCanvas.bind(this)),this.snowflakes=[]}updateConfig(t){this.config={...this.config,...t}}getSnowflakes(){return this.snowflakes}addSnowflake(t){const e=Math.random().toString(36).substr(2,9);this.snowflakes.push({id:e,x:t.x??Math.random()*this.canvas.width,y:t.y??-10,size:t.size??this.randomSize(),speed:t.speed??Math.random()*1.5+.5,opacity:t.opacity??Math.random()*.7+.3,wind:t.wind??(Math.random()-.5)*this.config.windStrength,rotation:t.rotation??0,rotationSpeed:t.rotationSpeed??(Math.random()-.5)*.02,shape:t.shape??this.randomShape()})}resizeCanvas(){const t=window.devicePixelRatio||1,e=this.canvas.getBoundingClientRect();this.canvas.width=e.width*t,this.canvas.height=e.height*t,this.ctx.scale(t,t),this.canvas.style.width=`${e.width}px`,this.canvas.style.height=`${e.height}px`}createInitialSnowflakes(){const t=Math.floor(this.config.intensity*.3);for(let e=0;e<t;e++)this.addSnowflake({})}updateSnowflakes(t){const e=t/16;this.snowflakes.forEach(n=>{n.y+=n.speed*e,n.x+=n.wind*e,n.rotation+=n.rotationSpeed*e,n.y>this.canvas.height&&(n.y=-10,n.x=Math.random()*this.canvas.width),n.x>this.canvas.width&&(n.x=0),n.x<0&&(n.x=this.canvas.width)})}drawSnowflakes(){this.snowflakes.forEach(t=>{switch(this.ctx.save(),this.ctx.translate(t.x,t.y),this.ctx.rotate(t.rotation),this.ctx.fillStyle=this.getSnowflakeColor(t.opacity),t.shape){case"star":this.drawStar(t.size);break;case"cross":this.drawCross(t.size);break;default:this.drawCircle(t.size)}this.ctx.restore()})}drawCircle(t){this.ctx.beginPath(),this.ctx.arc(0,0,t,0,Math.PI*2),this.ctx.fill()}drawStar(t){const n=t,i=t*.5;this.ctx.beginPath();for(let s=0;s<10;s++){const r=s%2===0?n:i,c=Math.PI*s/5,l=Math.cos(c)*r,a=Math.sin(c)*r;s===0?this.ctx.moveTo(l,a):this.ctx.lineTo(l,a)}this.ctx.closePath(),this.ctx.fill()}drawCross(t){this.ctx.fillRect(-t,-t/3,t*2,t*.66),this.ctx.fillRect(-t/3,-t,t*.66,t*2)}getSnowflakeColor(t){return this.config.colors[Math.floor(Math.random()*this.config.colors.length)].replace("opacity",t.toString())}randomSize(){return Math.random()*(this.config.snowflakeSize.max-this.config.snowflakeSize.min)+this.config.snowflakeSize.min}randomShape(){return this.config.shapes[Math.floor(Math.random()*this.config.shapes.length)]}clearCanvas(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}}class C{constructor(){this.elements=new Map,this.elementRects=new Map}registerElement(t,e,n={}){this.elements.set(t,{element:e,id:t,priority:n.priority||0,accumulationArea:n.accumulationArea||"top"}),this.updateRect(t)}unregisterElement(t){this.elements.delete(t),this.elementRects.delete(t)}updateRects(){this.elements.forEach((t,e)=>this.updateRect(e))}updateRect(t){const e=this.elements.get(t);e&&this.elementRects.set(t,e.element.getBoundingClientRect())}checkCollision(t,e){let n=null,i=-1;return this.elementRects.forEach((s,r)=>{const c=this.elements.get(r);if(t>=s.left&&t<=s.right&&e>=s.top&&e<=s.bottom)if(c.accumulationArea==="top"){const l=s.height*.3;e<=s.top+l&&c.priority>i&&(i=c.priority,n=r)}else c.priority>i&&(i=c.priority,n=r)}),n}getCollisionPoint(t,e,n){const i=this.elementRects.get(t);if(!i)return{x:e,y:n};if(this.elements.get(t).accumulationArea==="top"){const r=i.top+i.height*.3;return{x:Math.max(i.left,Math.min(e,i.right)),y:Math.max(i.top,Math.min(n,r))}}return{x:Math.max(i.left,Math.min(e,i.right)),y:Math.max(i.top,Math.min(n,i.bottom))}}}function E({className:w="",style:t,accumulationElements:e=[],onSnowflakeStuck:n}){const i=u.useRef(null),s=u.useRef(null),r=u.useRef(new C),c=u.useRef(void 0),{isEnabled:l,config:a,addStuckSnowflake:g,removeStuckSnowflake:S}=y();u.useEffect(()=>{const h=i.current;if(!h||!l)return;const o=new R(h,a);return s.current=o,o.init(),o.start(),()=>{o.destroy(),s.current=null}},[l]),u.useEffect(()=>{s.current&&s.current.updateConfig(a)},[a]),u.useEffect(()=>{if(!a.accumulation)return;e.forEach(o=>{document.querySelectorAll(o).forEach((d,p)=>{const m=`${o}-${p}`;r.current.registerElement(m,d,{priority:0,accumulationArea:"top"})})});const h=()=>{r.current.updateRects()};return window.addEventListener("resize",h),()=>window.removeEventListener("resize",h)},[e,a.accumulation]);const x=u.useCallback(()=>{if(!s.current||!a.accumulation)return;const h=s.current.getSnowflakes(),o=Date.now();h.forEach(f=>{const d=r.current.checkCollision(f.x,f.y);if(d){const p=r.current.getCollisionPoint(d,f.x,f.y),m={...f,stuck:!0,stuckTime:o,fadeStart:o+a.fadeDelay,elementId:d,x:p.x,y:p.y};g(d,m),n?.(d,m)}})},[a.accumulation,a.fadeDelay,g,n]);return u.useEffect(()=>{if(!a.accumulation)return;const h=()=>{const o=Date.now(),{stuckSnowflakes:f}=y.getState();f.forEach((d,p)=>{d.forEach(m=>{m.fadeStart&&o>m.fadeStart&&(o-m.fadeStart)/a.fadeDuration>=1&&S(p,m.id)})})};return c.current=window.setInterval(h,100),()=>{c.current&&clearInterval(c.current)}},[a.accumulation,a.fadeDuration,S]),u.useEffect(()=>{if(!l||!a.accumulation)return;const h=()=>{x(),requestAnimationFrame(h)},o=requestAnimationFrame(h);return()=>cancelAnimationFrame(o)},[l,a.accumulation,x]),l?v.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",pointerEvents:"none",zIndex:50},children:v.jsx("canvas",{ref:i,className:`fixed inset-0 pointer-events-none z-50 ${w}`,style:{...t,display:"block",width:"100%",height:"100%"}})}):null}E.__docgenInfo={description:`Component for rendering snowfall effect on a canvas with snowflake accumulation on specified elements.

@prop {string} [className] - CSS classes for the canvas element.
@prop {object} [style] - CSS styles for the canvas element.
@prop {string[]} [accumulationElements] - Selectors for elements where snowflakes should accumulate.
@prop {function} [onSnowflakeStuck] - Function called when a snowflake collides with an element.`,methods:[],displayName:"SnowCanvas",props:{className:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:'""',computed:!1}},style:{required:!1,tsType:{name:"ReactCSSProperties",raw:"React.CSSProperties"},description:""},accumulationElements:{required:!1,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:"",defaultValue:{value:"[]",computed:!1}},onSnowflakeStuck:{required:!1,tsType:{name:"signature",type:"function",raw:"(elementId: string, flake: StuckSnowflake) => void",signature:{arguments:[{type:{name:"string"},name:"elementId"},{type:{name:"StuckSnowflake"},name:"flake"}],return:{name:"void"}}},description:""}}};export{E as S};
